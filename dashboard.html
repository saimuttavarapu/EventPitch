<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Startup Dashboard - StartupCollab</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100">

  <!-- Navbar -->
  <nav class="bg-white shadow p-4 flex justify-between">
    <h1 class="text-xl font-bold text-blue-600">StartupCollab</h1>
    <div>
      <a href="dashboard.html" class="mx-2 text-gray-600 hover:text-blue-600">Dashboard</a>
      <a href="register.html" class="mx-2 text-gray-600 hover:text-blue-600">Register your Startup</a>
      <button id="logoutBtn" class="mx-2 text-red-600 hover:underline">Logout</button>
    </div>
  </nav>

  <!-- Heading and Description above cards -->
  <div class="max-w-6xl mx-auto mt-8 mb-4 px-4">
    <h2 class="text-3xl font-extrabold text-center text-gray-900 mb-2">Browse the Progress</h2>
    <p class="text-lg text-gray-700 font-medium text-center">
      Browse registered startups and find the right partners to co-create, attract investors, and scale faster.
    </p>
  </div>


  

  <section class="max-w-6xl mx-auto mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="startupContainer">
    <!-- Startup cards will be injected here -->
  </section>

  <script>
    const SUPABASE_URL = "https://mxydshsxgxdhcgoveocx.supabase.co"; // replace
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im14eWRzaHN4Z3hkaGNnb3Zlb2N4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1ODAzNTIsImV4cCI6MjA3MzE1NjM1Mn0.cvjGuvuY1z6WM6kjuGympgeDHfRMcLlOPf4Z8TjLxZI"
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const container = document.getElementById("startupContainer");
    const logoutBtn = document.getElementById("logoutBtn");

    // Check if user is logged in
    async function checkUser() {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) {
        window.location.href = "login.html";
      }
    }

    checkUser();

      
      async function inviteToCollaborate(startupId, button) {

      button.disabled = true;
      button.textContent = "Invitation sent!";
      button.classList.add("bg-green-500", "text-white", "cursor-not-allowed");
      button.classList.remove("bg-blue-600", "hover:bg-blue-700");


        if (!startupId) {
          alert("Invalid startup ID");
          return;
        }
      
        const { data: { user }, error: userError } = await supabase.auth.getUser();
        if (userError || !user) {
          alert("You must be logged in to send an invitation.");
          return;
        }
      
        const senderUid = user.id;
      
        const { data, error } = await supabase
          .from("invitations")
          .insert([{ sender_uid: senderUid, startup_id: startupId }]);
      
        if (error) {
          console.error("Error sending invitation:", error);
          alert("Failed to send invitation: " + error.message);
        } else {
          alert("âœ… Invitation sent successfully!");
        }
      }

    // Invitation sent handler
    function handleInvite(startupName, button) {

    }
    // Fetch startups
async function loadStartups() {
  const { data: startups, error } = await supabase.from("startups").select("*");
  if (error) {
    container.innerHTML = `<p class="text-red-600">Error loading startups: ${error.message}</p>`;
    return;
  }

  if (!startups || startups.length === 0) {
    container.innerHTML = `<p class="text-gray-600 text-center col-span-full">No startups registered yet.</p>`;
    return;
  }

  // Get logged-in user
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) return;

  container.innerHTML = "";

  for (let startup of startups) {
    const card = document.createElement("div");
    card.className = "bg-white p-6 rounded-lg shadow hover:shadow-lg transition flex flex-col justify-between";

    card.innerHTML = `
      <div>
        <h3 class="text-xl font-bold text-gray-800 mb-2">${startup.name}</h3>
        <p class="text-gray-600 mb-1"><strong>Industry:</strong> ${startup.industry}</p>
        <p class="text-gray-600 mb-4">${startup.description}</p>
      </div>
      <button
        class="mt-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition font-medium invite-btn"
        data-startup-id="${startup.id}"
      >
        Invite to Collaborate
      </button>
    `;

    container.appendChild(card);

    const inviteBtn = card.querySelector(".invite-btn");

    // Check if invitation already exists
    const { data: existingInvitation } = await supabase
      .from("invitations")
      .select("*")
      .eq("sender_uid", user.id)
      .eq("startup_id", startup.id)
      .single();

    if (existingInvitation) {
      // Disable button if invitation already sent
      inviteBtn.disabled = true;
      inviteBtn.textContent = "Invitation sent!";
      inviteBtn.classList.add("bg-green-500", "text-white", "cursor-not-allowed");
      inviteBtn.classList.remove("bg-blue-600", "hover:bg-blue-700");
    } else {
      // Attach click listener only if invitation not sent
      inviteBtn.addEventListener("click", function () {
        inviteToCollaborate(startup.id).then(() => {
          inviteBtn.disabled = true;
          inviteBtn.textContent = "Invitation sent!";
          inviteBtn.classList.add("bg-green-500", "text-white", "cursor-not-allowed");
          inviteBtn.classList.remove("bg-blue-600", "hover:bg-blue-700");
        });
      });
    }
  }
}


    loadStartups();

    // Logout function
    logoutBtn.addEventListener("click", async () => {
      await supabase.auth.signOut();
      window.location.href = "login.html";
    });
  </script>


</body>
</html>
